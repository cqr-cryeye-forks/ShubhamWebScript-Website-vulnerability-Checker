#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# ShubhamWebScript is a Web Applications Security Scanner
# By Shubham Kumar Sinha - hinhiteachcomputer @gmail.com

import argparse
import json
import pathlib
from typing import Final

from headers import *
from vulnz import *


def scan_url(url, output_json):
    if "?" in url:
        data1, data_massage1 = rce_func(url)
        data2, data_massage2 = xss_func(url)
        data3, data_massage3 = error_based_sqli_func(url)
        all_data = [
            {"Message": data_massage1,
             **data1, },
            {"Message": data_massage2,
             **data2, },
            {"Message": data_massage3,
             **data3, }
        ]
    else:
        # print(f"{ga.red}\n[Warning] {ga.end}{ga.bold}{url}{ga.end}{ga.red} is not a valid URL{ga.end}")
        # print(f"{ga.red}[Warning] You should write a Full URL e.g. http://site.com/page.php?id=value\n{ga.end}")
        all_data = {
            "Message": "Nothing found for ur target in ShubdhamWebScript",
        }
    with open(output_json, "w") as jf:
        json.dump(all_data, jf, indent=2)


def main():
    parser = argparse.ArgumentParser(description="ShubhamWebScript is a Web Applications Security Scanner")
    parser.add_argument('--target', type=str, required=True, help="URL or list file to scan")
    parser.add_argument('--output', type=str, required=True, help="Output file path. data.json")

    args = parser.parse_args()
    target: str = args.target

    MAIN_DIR: Final[pathlib.Path] = pathlib.Path(__file__).parent
    OUTPUT_JSON: Final[pathlib.Path] = MAIN_DIR / args.output

    if target.startswith("http"):
        scan_url(target, OUTPUT_JSON)
    else:
        all_data = {
            "Message": "Nothing found for ur target in ShubdhamWebScript",
        }
        with open(OUTPUT_JSON, "w") as jf:
            json.dump(all_data, jf, indent=2)


if __name__ == "__main__":
    main()
